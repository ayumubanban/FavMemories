
<div class="box">


  <figure class="image is-128x128">
    <% if @user.avatar.attached? %>
      <%# Magnific Popupでクリックしたらポップアップ画像が表示されるようにした %>
      <%= link_to image_tag(@user.avatar, class: "is-rounded"), @user.avatar, class: "popup-link" %>
    <% else %>
      <img src="/blue_egg.jpg" class="is-rounded">
    <% end %>
  </figure>
  <%= link_to @user.name, "/users/#{@user.id}" %>

  <p><%= @post.content %></p>
  <div class="post-time">
    <%= @post.created_at %>
  </div>

  <%# ログインしてる？ %>
  <% if @current_user %>
    <% if @current_user != @user %>
      <% if @user.followed_by?(@current_user) %>
        <%= link_to "/users/#{@user.id}/relationships", method: :delete, remote: true do %>
          <%# フォロー済み %>
          <button class="button is-rounded is-info is-normal">フォロー済み</button>
        <% end %>
      <% else %>
        <%= link_to "/users/#{@user.id}/relationships", method: :post, remote: true do %>
          <%# フォローする %>
          <button class="button is-rounded has-text-info is-normal" style="border-color: #3298dc;">フォローする</button>
        <% end %>
      <% end %>
    <% end %>
  <% else %>
    <%# ログインを促される宿命 %>
    <%= link_to "/users/#{@user.id}/relationships", method: :post, remote: true do %>
      <button class="button is-rounded has-text-info is-normal" style="border-color: #3298dc;">フォローする</button>
    <% end %>
  <% end %>

  <%# ログインしてる？ %>
  <% if @current_user %>
    <%# ここでロジック持ってくるのはちょっと…他にうまいやり方あるやろ %>
    <% if Like.find_by(user_id: @current_user.id, post_id: @post.id ) %>
      <%#= link_to "/likes/#{@post.id}/destroy", method: :post, remote: true do %>
      <%= link_to "/posts/#{@post.id}/likes", method: :delete, remote: true do %>
        <span class="fa fa-heart like-btn-unlike has-text-danger"></span>
      <% end %>
    <% else %>
      <%#= link_to "/likes/#{@post.id}/create", method: :post, remote: true do %>
      <%= link_to "/posts/#{@post.id}/likes", method: :post, remote: true do %>
        <span class="fa fa-heart like-btn has-text-grey"></span>
      <% end %>
    <% end %>
    <%= @likes_count %>
  <% else %>
    <%# ログインを促される宿命 %>
    <%= link_to "/posts/#{@post.id}/likes", method: :post, remote: true do %>
      <span class="fa fa-heart like-btn has-text-grey"></span>
    <% end %>
    <%= @post.likes.count %>
  <% end %>

  <%# ログインしてる？ %>
  <% if @current_user %>
    <div class="post-menus">
        <% if @post.user_id == @current_user.id %>
          <%= link_to("編集", "/posts/#{@post.id}/edit") %>
          <%= link_to("削除", "/posts/#{@post.id}", method: :delete) %>
        <% end %>
    </div>
  <% end %>


</div>


<div class="box">
  <% @comments.each do |comment| %>

    <article class="media">
      <figure class="media-left">
        <p class="image is-64x64">
          <% if comment.user.avatar.attached? %>
            <%= image_tag comment.user.avatar, class: "is-rounded" %>
          <% else %>
            <img src="/blue_egg.jpg" class="is-rounded">
          <% end %>
        </p>
      </figure>
      <div class="media-content">
        <div class="content">
          <p>
            <strong><%= link_to(comment.user.name, "/users/#{comment.user.id}", class: "has-text-black") %></strong>
            <br>
            <%= comment.content %>
          </p>
        </div>

        <%# ログインしてる？ %>
        <% if @current_user %>
          <% if comment.user_id == @current_user.id %>
            <%= link_to("削除", "/posts/#{@post.id}/comments/#{comment.id}", method: :delete, remote: true) %>
          <% end %>
        <% end %>
      </div>
    </article>

  <% end %>
</div>

<%# ログインしてる？ %>
<% if @current_user %>
  <%= form_with model: [@post, @comment], url: "/posts/#{@post.id}/comments", local: true do |form| %>
    <p>
      <%= form.label :content, "コメント" %>
      <%= form.text_field :content %>
    </p>
    <%= form.submit %>
  <% end %>
<% end %>